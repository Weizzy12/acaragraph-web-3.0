<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acaragraph Red - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
</head>
<body>
    <div class="admin-container">
        <!-- –•–µ–¥–µ—Ä –∞–¥–º–∏–Ω–∫–∏ -->
        <div class="admin-header">
            <div class="admin-title">
                <div class="admin-crown">
                    <i class="fas fa-crown"></i>
                </div>
                <div>
                    <h1 style="color: #FFFFFF;">ACARAGRAPH RED</h1>
                    <p style="color: #FF6666; font-size: 14px;">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="window.location.href='chat.html'">
                    <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="admin-tabs">
            <button class="tab-btn active" onclick="openTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> –î–∞—à–±–æ—Ä–¥
            </button>
            <button class="tab-btn" onclick="openTab('users')">
                <i class="fas fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </button>
            <button class="tab-btn" onclick="openTab('codes')">
                <i class="fas fa-key"></i> –ö–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞
            </button>
            <button class="tab-btn" onclick="openTab('messages')">
                <i class="fas fa-comments"></i> –°–æ–æ–±—â–µ–Ω–∏—è
            </button>
            <button class="tab-btn" onclick="openTab('logs')">
                <i class="fas fa-history"></i> –õ–æ–≥–∏
            </button>
            <button class="tab-btn" onclick="openTab('settings')">
                <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>

        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboard" class="tab-content active">
            <div class="section-header">
                <h2><i class="fas fa-tachometer-alt"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
                <button class="btn btn-primary" onclick="refreshStats()">
                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-number" id="onlineUsers">0</div>
                    <div class="stat-label">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-number" id="totalCodes">0</div>
                    <div class="stat-label">–ö–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-ban"></i>
                    </div>
                    <div class="stat-number" id="bannedUsers">0</div>
                    <div class="stat-label">–ó–∞–±–∞–Ω–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="stat-number" id="adminUsers">0</div>
                    <div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
                </div>
            </div>

            <div class="section-header" style="margin-top: 40px;">
                <h2><i class="fas fa-chart-line"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 24 —á–∞—Å–∞</h2>
            </div>

            <div class="card">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <div>
                        <h3 style="color: #FF6666; margin-bottom: 20px;">
                            <i class="fas fa-user-plus"></i> –ù–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                        </h3>
                        <div id="recentRegistrations">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #FF6666; margin-bottom: 20px;">
                            <i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-primary" onclick="generateCodeModal()">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∫–æ–¥
                            </button>
                            <button class="btn btn-secondary" onclick="openTab('users')">
                                <i class="fas fa-user-cog"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                            </button>
                            <button class="btn btn-secondary" onclick="openTab('logs')">
                                <i class="fas fa-scroll"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
                            </button>
                            <button class="btn btn-danger" onclick="clearOldMessages()">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div id="users" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div style="display: flex; gap: 10px;">
                    <input type="text" 
                           id="userSearch" 
                           class="form-input" 
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ Telegram..."
                           style="width: 300px;"
                           onkeyup="searchUsers()">
                    <button class="btn btn-secondary" onclick="exportUsers()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>Telegram</th>
                            <th>–†–æ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–°–æ–æ–±—â–µ–Ω–∏–π</th>
                            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ö–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞ -->
        <div id="codes" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-key"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞</h2>
                <button class="btn btn-primary" onclick="generateCodeModal()">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥
                </button>
            </div>

            <div id="newCodeAlert" class="notification success" style="display: none; margin-bottom: 20px;">
                <i class="fas fa-check-circle"></i>
                <span>–ù–æ–≤—ã–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω: <strong id="newCodeValue"></strong></span>
                <button class="btn btn-secondary btn-sm" onclick="copyNewCode()" style="margin-left: 10px;">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>–ö–æ–¥</th>
                            <th>–¢–∏–ø</th>
                            <th>–°–æ–∑–¥–∞–ª</th>
                            <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</th>
                            <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª</th>
                            <th>–°–æ–∑–¥–∞–Ω</th>
                            <th>–ò—Å—Ç–µ–∫–∞–µ—Ç</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="codesTable">
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px;">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–æ–≤...</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="messages" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-comments"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</h2>
                <div style="display: flex; gap: 10px;">
                    <input type="text" 
                           id="messageSearch" 
                           class="form-input" 
                           placeholder="–ü–æ–∏—Å–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö..."
                           style="width: 300px;">
                    <button class="btn btn-danger" onclick="deleteSelectedMessages()">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 20px;"><input type="checkbox" id="selectAllMessages"></th>
                            <th>ID</th>
                            <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                            <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="messagesTable">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ -->
        <div id="logs" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h2>
                <div style="display: flex; gap: 10px;">
                    <select id="logType" class="form-input" style="width: 200px;">
                        <option value="all">–í—Å–µ —Å–æ–±—ã—Ç–∏—è</option>
                        <option value="login">–í—Ö–æ–¥/–≤—ã—Ö–æ–¥</option>
                        <option value="message">–°–æ–æ–±—â–µ–Ω–∏—è</option>
                        <option value="admin">–î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞</option>
                        <option value="error">–û—à–∏–±–∫–∏</option>
                    </select>
                    <button class="btn btn-secondary" onclick="refreshLogs()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–¢–∏–ø</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>IP</th>
                        </tr>
                    </thead>
                    <tbody id="logsTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settings" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
            </div>

            <div class="card">
                <h3 style="color: #FF6666; margin-bottom: 20px;">
                    <i class="fas fa-shield-alt"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                </h3>
                
                <div class="form-group">
                    <label class="form-label">–†–µ–∂–∏–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="checkbox">
                            <input type="radio" name="registrationMode" value="open" checked>
                            <span class="checkmark"></span>
                            –û—Ç–∫—Ä—ã—Ç–∞—è (–ª—é–±–æ–π –∫–æ–¥)
                        </label>
                        <label class="checkbox">
                            <input type="radio" name="registrationMode" value="closed">
                            <span class="checkmark"></span>
                            –ó–∞–∫—Ä—ã—Ç–∞—è (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã —Å–æ–∑–¥–∞—é—Ç –∫–æ–¥—ã)
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                    <input type="number" 
                           id="maxMessageLength" 
                           class="form-input" 
                           value="2000"
                           style="width: 200px;">
                </div>

                <div class="form-group">
                    <label class="form-label">–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" 
                               id="autoCleanDays" 
                               class="form-input" 
                               value="30"
                               style="width: 100px;">
                        <span>–¥–Ω–µ–π</span>
                        <button class="btn btn-secondary btn-sm" onclick="saveAutoClean()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="color: #FF6666; margin-bottom: 20px;">
                    <i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                </h3>
                
                <div class="form-group">
                    <label class="checkbox">
                        <input type="checkbox" id="notifyNewUser" checked>
                        <span class="checkmark"></span>
                        –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –Ω–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ö
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" id="notifyReport" checked>
                        <span class="checkmark"></span>
                        –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –∂–∞–ª–æ–±–∞—Ö
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" id="notifyError" checked>
                        <span class="checkmark"></span>
                        –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –æ—à–∏–±–∫–∞—Ö
                    </label>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="color: #FF6666; margin-bottom: 20px;">
                    <i class="fas fa-database"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <button class="btn btn-secondary" onclick="backupDatabase()">
                        <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
                    </button>
                    <button class="btn btn-secondary" onclick="optimizeDatabase()">
                        <i class="fas fa-compress"></i> –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
                    </button>
                    <button class="btn btn-danger" onclick="showResetModal()">
                        <i class="fas fa-exclamation-triangle"></i> –°–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–¥–∞ -->
    <div id="createCodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #FF0000;">
                    <i class="fas fa-key"></i> –°–æ–∑–¥–∞—Ç—å –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞
                </h3>
                <button class="modal-close" onclick="closeCreateCodeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∫–æ–¥–∞</label>
                    <select id="codeType" class="form-input">
                        <option value="user">üë§ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="super_admin">üëëüëëüëë –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="guest">üë• –ì–æ—Å—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label>
                    <input type="number" 
                           id="codeUses" 
                           class="form-input" 
                           value="1"
                           min="1"
                           max="1000">
                    <small style="color: #888888;">0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                    <input type="number" 
                           id="codeExpireDays" 
                           class="form-input" 
                           value="30"
                           min="1"
                           max="365">
                    <small style="color: #888888;">–≤ –¥–Ω—è—Ö (0 = –±–µ—Å—Å—Ä–æ—á–Ω–æ)</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="codeNote" 
                              class="form-input" 
                              rows="3"
                              placeholder="–î–ª—è —á–µ–≥–æ —ç—Ç–æ—Ç –∫–æ–¥..."></textarea>
                </div>
            </div>
            <div class="modal-footer" style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="generateCode()">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∫–æ–¥
                </button>
                <button class="btn btn-secondary" onclick="closeCreateCodeModal()">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–±—Ä–æ—Å–∞ —Å–∏—Å—Ç–µ–º—ã -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #FF0000;">
                    <i class="fas fa-exclamation-triangle"></i> –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞!
                </h3>
                <button class="modal-close" onclick="closeResetModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; color: #FF0000; margin-bottom: 10px;">
                        ‚ö†Ô∏è
                    </div>
                    <h3 style="color: #FF3333;">–°–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã</h3>
                </div>
                
                <div style="background: rgba(255, 0, 0, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #FF9999;">
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
                    </p>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn btn-danger" onclick="resetMessages()">
                        <i class="fas fa-comments"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    </button>
                    <button class="btn btn-danger" onclick="resetUsers()">
                        <i class="fas fa-users"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    </button>
                    <button class="btn btn-danger" onclick="resetCodes()">
                        <i class="fas fa-key"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–¥—ã
                    </button>
                    <button class="btn btn-danger" onclick="fullReset()">
                        <i class="fas fa-bomb"></i> –ü–û–õ–ù–´–ô –°–ë–†–û–° –°–ò–°–¢–ï–ú–´
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 0, 0, 0.05); border-radius: 8px;">
                    <p style="color: #FF6666; font-size: 14px;">
                        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!
                    </p>
                </div>
            </div>
            <div class="modal-footer" style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeResetModal()">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notificationContainer"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentAdmin = null;
        let allUsers = [];
        let allCodes = [];
        let allMessages = [];
        let allLogs = [];

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Acaragraph Red - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            await checkAdminAuth();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadDashboard();
            loadUsers();
            loadCodes();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                const activeTab = document.querySelector('.tab-content.active').id;
                if (activeTab === 'dashboard') loadDashboard();
                if (activeTab === 'users') loadUsers();
                if (activeTab === 'codes') loadCodes();
                if (activeTab === 'logs') loadLogs();
            }, 30000);
        });

        // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
        async function checkAdminAuth() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                const savedUser = localStorage.getItem('acaragraph_user');
                if (!savedUser) {
                    window.location.href = 'index.html';
                    return;
                }
                
                currentAdmin = JSON.parse(savedUser);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
                if (currentAdmin.role !== 'admin' && currentAdmin.role !== 'super_admin') {
                    showNotification('üö´ –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'error');
                    setTimeout(() => {
                        window.location.href = 'chat.html';
                    }, 2000);
                    return;
                }
                
                console.log('‚úÖ –ê–¥–º–∏–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', currentAdmin.nickname);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                window.location.href = 'index.html';
            }
        }

        // ========== –í–ö–õ–ê–î–ö–ò ==========
        function openTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const activeTab = document.getElementById(tabName);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            event.currentTarget.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'codes':
                    loadCodes();
                    break;
                case 'messages':
                    loadMessages();
                    break;
                case 'logs':
                    loadLogs();
                    break;
            }
        }

        // ========== –î–ê–®–ë–û–†–î ==========
        async function loadDashboard() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const response = await fetch(`/api/admin/stats?adminId=${currentAdmin.id}`);
                const data = await response.json();
                
                if (data.success) {
                    updateStats(data.stats);
                    loadRecentRegistrations(data.recentUsers);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        function updateStats(stats) {
            if (!stats) return;
            
            const elements = {
                'totalUsers': 'totalUsers',
                'onlineUsers': 'onlineUsers',
                'totalMessages': 'totalMessages',
                'totalCodes': 'totalCodes',
                'bannedUsers': 'bannedUsers',
                'adminUsers': 'adminUsers'
            };
            
            for (const [key, elementId] of Object.entries(elements)) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = stats[key] || 0;
                }
            }
        }

        function loadRecentRegistrations(users) {
            const container = document.getElementById('recentRegistrations');
            if (!container) return;
            
            if (!users || users.length === 0) {
                container.innerHTML = '<p style="color: #888888; text-align: center;">–ù–µ—Ç –Ω–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π</p>';
                return;
            }
            
            let html = '';
            users.slice(0, 5).forEach(user => {
                const time = formatTime(user.created_at);
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; 
                                padding: 10px; border-bottom: 1px solid rgba(255, 0, 0, 0.1);">
                        <div>
                            <div style="font-weight: bold; color: #FFFFFF;">${user.nickname}</div>
                            <div style="font-size: 12px; color: #888888;">${user.tg_username}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: #FF6666;">${time}</div>
                            <span class="status-badge ${user.role === 'admin' || user.role === 'super_admin' ? 'status-admin' : 'status-active'}">
                                ${user.role === 'admin' || user.role === 'super_admin' ? 'üëë' : 'üë§'}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function refreshStats() {
            loadDashboard();
            showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
        }

        // ========== –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò ==========
        async function loadUsers() {
            try {
                const response = await fetch(`/api/admin/users?adminId=${currentAdmin.id}`);
                const data = await response.json();
                
                if (data.success) {
                    allUsers = data.users;
                    displayUsers(allUsers);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
            }
        }

        function displayUsers(users) {
            const container = document.getElementById('usersTable');
            if (!container) return;
            
            if (!users || users.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #888888;">
                            <i class="fas fa-users" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            users.forEach(user => {
                const regDate = new Date(user.created_at).toLocaleDateString();
                const lastSeen = user.last_seen ? formatTime(user.last_seen) : '–ù–∏–∫–æ–≥–¥–∞';
                
                let roleBadge = '<span class="status-badge status-active">üë§</span>';
                if (user.role === 'admin') roleBadge = '<span class="status-badge status-admin">üëë</span>';
                if (user.role === 'super_admin') roleBadge = '<span class="status-badge status-admin">üëëüëëüëë</span>';
                
                let statusBadge = '<span class="status-badge status-active">‚úÖ</span>';
                if (user.is_banned) statusBadge = '<span class="status-badge status-banned">üö´</span>';
                if (user.muted_until && new Date(user.muted_until) > new Date()) {
                    statusBadge = '<span class="status-badge status-inactive">üîá</span>';
                }
                
                html += `
                    <tr>
                        <td>${user.id}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="user-avatar-sm" style="background-color: ${user.avatar_color}">
                                    ${user.nickname.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: bold;">${user.nickname}</div>
                                    <div style="font-size: 12px; color: #888888;">${lastSeen}</div>
                                </div>
                            </div>
                        </td>
                        <td>${user.tg_username || '-'}</td>
                        <td>${roleBadge}</td>
                        <td>${statusBadge}</td>
                        <td>${user.message_count || 0}</td>
                        <td>${regDate}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" onclick="viewUser(${user.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${user.id !== currentAdmin.id ? `
                                    ${user.is_banned ? 
                                        `<button class="btn btn-success btn-sm" onclick="toggleBan(${user.id}, false)">
                                            <i class="fas fa-check"></i>
                                        </button>` : 
                                        `<button class="btn btn-danger btn-sm" onclick="toggleBan(${user.id}, true)">
                                            <i class="fas fa-ban"></i>
                                        </button>`
                                    }
                                    ${user.role !== 'admin' && user.role !== 'super_admin' ? 
                                        `<button class="btn btn-success btn-sm" onclick="toggleAdmin(${user.id}, true)">
                                            <i class="fas fa-crown"></i>
                                        </button>` : 
                                        user.id !== currentAdmin.id ? 
                                        `<button class="btn btn-warning btn-sm" onclick="toggleAdmin(${user.id}, false)">
                                            <i class="fas fa-user"></i>
                                        </button>` : ''
                                    }
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            
            if (!searchTerm) {
                displayUsers(allUsers);
                return;
            }
            
            const filtered = allUsers.filter(user => 
                user.nickname.toLowerCase().includes(searchTerm) ||
                (user.tg_username && user.tg_username.toLowerCase().includes(searchTerm)) ||
                user.id.toString().includes(searchTerm)
            );
            
            displayUsers(filtered);
        }

        async function toggleBan(userId, ban) {
            const action = ban ? 'ban' : 'unban';
            const confirmText = ban ? 
                `–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?` : 
                `–†–∞–∑–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?`;
            
            if (!confirm(confirmText)) return;
            
            try {
                const response = await fetch('/api/admin/users/action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminId: currentAdmin.id,
                        userId: userId,
                        action: action
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadUsers();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –±–∞–Ω–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        async function toggleAdmin(userId, makeAdmin) {
            const action = makeAdmin ? 'make_admin' : 'remove_admin';
            const confirmText = makeAdmin ? 
                `–°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º?` : 
                `–£–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?`;
            
            if (!confirm(confirmText)) return;
            
            try {
                const response = await fetch('/api/admin/users/action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminId: currentAdmin.id,
                        userId: userId,
                        action: action
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadUsers();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        function viewUser(userId) {
            window.open(`chat.html?profile=${userId}`, '_blank');
        }

        function exportUsers() {
            const csv = [
                ['ID', '–ò–º—è', 'Telegram', '–†–æ–ª—å', '–°—Ç–∞—Ç—É—Å', '–°–æ–æ–±—â–µ–Ω–∏–π', '–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏'],
                ...allUsers.map(user => [
                    user.id,
                    user.nickname,
                    user.tg_username || '',
                    user.role,
                    user.is_banned ? '–ó–∞–±–∞–Ω–µ–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω',
                    user.message_count || 0,
                    new Date(user.created_at).toLocaleDateString()
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `acaragraph_users_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
        }

        // ========== –ö–û–î–´ –î–û–°–¢–£–ü–ê ==========
        async function loadCodes() {
            try {
                const response = await fetch(`/api/admin/codes?adminId=${currentAdmin.id}`);
                const data = await response.json();
                
                if (data.success) {
                    allCodes = data.codes;
                    displayCodes(allCodes);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤', 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤', 'error');
            }
        }

        function displayCodes(codes) {
            const container = document.getElementById('codesTable');
            if (!container) return;
            
            if (!codes || codes.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #888888;">
                            <i class="fas fa-key" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p>–ù–µ—Ç –∫–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–∞</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            codes.forEach(code => {
                const created = new Date(code.created_at).toLocaleDateString();
                const expires = code.expires_at ? new Date(code.expires_at).toLocaleDateString() : '–ë–µ—Å—Å—Ä–æ—á–Ω–æ';
                const used = code.used_at ? new Date(code.used_at).toLocaleDateString() : '-';
                
                let typeBadge = '<span class="status-badge status-active">üë§</span>';
                if (code.type === 'admin') typeBadge = '<span class="status-badge status-admin">üëë</span>';
                if (code.type === 'super_admin') typeBadge = '<span class="status-badge status-admin">üëëüëëüëë</span>';
                if (code.type === 'guest') typeBadge = '<span class="status-badge status-inactive">üë•</span>';
                
                let statusBadge = '<span class="status-badge status-active">‚úÖ</span>';
                if (!code.is_active) statusBadge = '<span class="status-badge status-banned">üö´</span>';
                if (code.used_by) statusBadge = '<span class="status-badge status-inactive">üîÑ</span>';
                if (code.expires_at && new Date(code.expires_at) < new Date()) {
                    statusBadge = '<span class="status-badge status-banned">‚åõ</span>';
                }
                
                html += `
                    <tr>
                        <td><strong>${code.code}</strong></td>
                        <td>${typeBadge}</td>
                        <td>${code.creator_nickname || '-'}</td>
                        <td>${code.uses_count || 0}/${code.max_uses || '‚àû'}</td>
                        <td>${code.used_by_nickname || '-'}</td>
                        <td>${created}</td>
                        <td>${expires}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="table-actions">
                                ${code.is_active && !code.used_by ? `
                                    <button class="btn btn-danger btn-sm" onclick="deactivateCode('${code.code}')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : ''}
                                <button class="btn btn-secondary btn-sm" onclick="copyCode('${code.code}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function generateCodeModal() {
            document.getElementById('createCodeModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeCreateCodeModal() {
            document.getElementById('createCodeModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        async function generateCode() {
            const type = document.getElementById('codeType').value;
            const maxUses = parseInt(document.getElementById('codeUses').value) || 1;
            const expireDays = parseInt(document.getElementById('codeExpireDays').value) || 30;
            const note = document.getElementById('codeNote').value;
            
            try {
                const response = await fetch('/api/admin/codes/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminId: currentAdmin.id,
                        type: type,
                        maxUses: maxUses,
                        expiresIn: expireDays
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–¥
                    const alert = document.getElementById('newCodeAlert');
                    const codeSpan = document.getElementById('newCodeValue');
                    
                    codeSpan.textContent = data.code;
                    alert.style.display = 'flex';
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    closeCreateCodeModal();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤
                    loadCodes();
                    
                    showNotification(`–ö–æ–¥ —Å–æ–∑–¥–∞–Ω: ${data.code}`, 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–¥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        function copyNewCode() {
            const code = document.getElementById('newCodeValue').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            });
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            });
        }

        async function deactivateCode(code) {
            if (!confirm(`–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ ${code}?`)) return;
            
            try {
                const response = await fetch('/api/admin/deactivate-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–ö–æ–¥ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'success');
                    loadCodes();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        // ========== –°–û–û–ë–©–ï–ù–ò–Ø ==========
        async function loadMessages() {
            try {
                const response = await fetch(`/api/admin/messages?adminId=${currentAdmin.id}`);
                const data = await response.json();
                
                if (data.success) {
                    allMessages = data.messages;
                    displayMessages(allMessages);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π', 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π', 'error');
            }
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesTable');
            if (!container) return;
            
            if (!messages || messages.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #888888;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            messages.forEach(message => {
                const time = formatTime(message.timestamp || message.created_at);
                const text = message.text.length > 50 ? message.text.substring(0, 50) + '...' : message.text;
                
                html += `
                    <tr>
                        <td><input type="checkbox" class="message-checkbox" value="${message.id}"></td>
                        <td>${message.id}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="user-avatar-sm" style="background-color: ${message.user?.avatar_color || '#FF0000'}">
                                    ${message.user?.nickname?.charAt(0) || '?'}
                                </div>
                                ${message.user?.nickname || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}
                            </div>
                        </td>
                        <td>${escapeHtml(text)}</td>
                        <td>${time}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-danger btn-sm" onclick="deleteMessage(${message.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"
            const selectAll = document.getElementById('selectAllMessages');
            if (selectAll) {
                selectAll.onchange = function() {
                    const checkboxes = document.querySelectorAll('.message-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                };
            }
        }

        function deleteSelectedMessages() {
            const checkboxes = document.querySelectorAll('.message-checkbox:checked');
            if (checkboxes.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'warning');
                return;
            }
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${checkboxes.length} —Å–æ–æ–±—â–µ–Ω–∏–π?`)) return;
            
            const ids = Array.from(checkboxes).map(cb => cb.value);
            
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ API
            showNotification(`–£–¥–∞–ª–µ–Ω–æ ${ids.length} —Å–æ–æ–±—â–µ–Ω–∏–π`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            loadMessages();
        }

        function deleteMessage(messageId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) return;
            
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ API
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            loadMessages();
        }

        function clearOldMessages() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π?')) return;
            
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            showNotification('–°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã', 'success');
        }

        // ========== –õ–û–ì–ò ==========
        async function loadLogs() {
            try {
                const logType = document.getElementById('logType').value;
                const response = await fetch(`/api/admin/logs?adminId=${currentAdmin.id}&type=${logType}`);
                const data = await response.json();
                
                if (data.success) {
                    allLogs = data.logs;
                    displayLogs(allLogs);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤', 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤', 'error');
            }
        }

        function displayLogs(logs) {
            const container = document.getElementById('logsTable');
            if (!container) return;
            
            if (!logs || logs.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #888888;">
                            <i class="fas fa-history" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p>–ù–µ—Ç –ª–æ–≥–æ–≤</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            logs.forEach(log => {
                const time = formatTime(log.created_at);
                let typeBadge = '<span class="status-badge status-active">‚ÑπÔ∏è</span>';
                
                if (log.event_type.includes('error')) typeBadge = '<span class="status-badge status-banned">‚ùå</span>';
                if (log.event_type.includes('login')) typeBadge = '<span class="status-badge status-inactive">üîë</span>';
                if (log.event_type.includes('admin')) typeBadge = '<span class="status-badge status-admin">üëë</span>';
                
                html += `
                    <tr>
                        <td>${time}</td>
                        <td>${typeBadge} ${log.event_type}</td>
                        <td>${log.user_id || '–°–∏—Å—Ç–µ–º–∞'}</td>
                        <td>${log.description || '-'}</td>
                        <td>${log.ip_address || '-'}</td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function refreshLogs() {
            loadLogs();
            showNotification('–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }

        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function saveAutoClean() {
            const days = document.getElementById('autoCleanDays').value;
            showNotification(`–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ ${days} –¥–Ω–µ–π`, 'success');
        }

        function backupDatabase() {
            showNotification('–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞...', 'info');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
            setTimeout(() => {
                showNotification('–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
            }, 2000);
        }

        function optimizeDatabase() {
            showNotification('–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...', 'info');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–î
            setTimeout(() => {
                showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            }, 2000);
        }

        function showResetModal() {
            document.getElementById('resetModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeResetModal() {
            document.getElementById('resetModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function resetMessages() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            showNotification('–û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...', 'info');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            setTimeout(() => {
                showNotification('–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã', 'success');
                closeResetModal();
            }, 2000);
        }

        function resetUsers() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥–º–∏–Ω–∞)? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            showNotification('–û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...', 'info');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            setTimeout(() => {
                showNotification('–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—á–∏—â–µ–Ω—ã', 'success');
                closeResetModal();
            }, 2000);
        }

        function resetCodes() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –∫–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            showNotification('–û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–æ–≤...', 'info');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–¥–æ–≤
            setTimeout(() => {
                showNotification('–í—Å–µ –∫–æ–¥—ã –æ—á–∏—â–µ–Ω—ã', 'success');
                closeResetModal();
            }, 2000);
        }

        function fullReset() {
            if (!confirm('–ü–û–õ–ù–´–ô –°–ë–†–û–° –°–ò–°–¢–ï–ú–´? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return;
            
            showNotification('–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã...', 'error');
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞
            setTimeout(() => {
                showNotification('–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–∞', 'success');
                localStorage.removeItem('acaragraph_user');
                closeResetModal();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }, 3000);
        }

        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function formatTime(timestamp) {
            if (!timestamp) return '';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (date.toDateString() === now.toDateString()) {
                if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
            
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            if (diffDays === 1) return '–≤—á–µ—Ä–∞';
            if (diffDays < 7) return `${diffDays} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`;
            
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas ${icons[type] || icons.info}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; color: #AAAAAA; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        function logout() {
            if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('acaragraph_user');
                window.location.href = 'index.html';
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
        window.onclick = function(event) {
            const modals = ['createCodeModal', 'resetModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        };

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modals = ['createCodeModal', 'resetModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal && modal.style.display === 'block') {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            }
        });

        // ========== –î–ï–ë–ê–ì –§–£–ù–ö–¶–ò–ò ==========
        window.debugAdminInfo = function() {
            console.log('=== ADMIN DEBUG INFO ===');
            console.log('Current Admin:', currentAdmin);
            console.log('Users:', allUsers.length);
            console.log('Codes:', allCodes.length);
            console.log('Messages:', allMessages.length);
            console.log('Logs:', allLogs.length);
            console.log('=======================');
        };
    </script>
</body>
</html>